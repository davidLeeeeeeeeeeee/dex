package witness

// 见证者模块，用于区块链入账跨链资产。每当用户有入账tx请求时候，用hash来指定见证者。
//
// 见证者质押与解质押机制设计：
//
// 1. 质押 (Staking)
//    - 目的：确保见证者诚实履行验证职责，防止恶意行为。
//    - 质押物：
//      a. 初始阶段：可能需要一定数量的系统代币或稳定币（如 1000 U 等值代币）。
//      b. 长期运行：可采用“未来收益质押”模式，即见证者通过长期诚实服务积累的未提取收益作为质押金，降低准入门槛。
//    - 状态流转：
//      [Candidate] --(质押)--> [Active]
//
// 2. 解质押 (Unstaking)
//    - 申请：见证者可随时发起解质押申请。
//    - 锁定期 (Lock-up Period)：
//      申请后进入“解质押中 (Unstaking)”状态，资金需锁定一段时间（如 7 天）。
//      在此期间，见证者不再参与新交易的验证，但仍需对之前的验证行为负责。
//    - 提现：锁定期结束后，若无未处理的挑战或罚没，资金退回至见证者账户。
//    - 状态流转：
//      [Active] --(申请解质押)--> [Unstaking] --(锁定期满)--> [Exited]
//
// 3. 挑战与罚没 (Slashing)
//    - 触发条件：
//      a. 恶意签名：对无效交易签名。
//      b. 长期不在线/未响应（视严重程度扣除部分收益或罚没）。
//    - 挑战期 (Challenge Period)：
//      共识达成后进入公示期（如 5min - 24h），期间任何人可发起挑战。
//      挑战者需质押一定资金（如 100 U），以防滥用挑战。
//    - 裁决：
//      由更广泛的见证者集合或高权益节点进行仲裁。
//    - 惩罚执行：
//      若挑战成功：罚没见证者质押金（部分销毁，部分奖励给挑战者）。
//      若挑战失败：罚没挑战者质押金。

// 见证者在网页端看到自己被指定后就去各自的区块链浏览器验证，发送签名并广播。
// 共识只需要收集80%~100%见证者签名即可上账。
// 如果节点收到了超过80%的未通过消息后，会将该笔入账tx标记为入账失败
// 		如果通过、未通过都没有一方超过80%（到截止时间，或者全部人都已经投票，或者已经提前计算出无法达成共识）->扩大采样范围。
// 		通过、未通过都有公示期（5min，30min,24h），公示期内任何人都可以发起挑战，挑战者需要质押100U左右的资产，以免恶意挑战。

// 扩大范围
//若5min后没有达到签名阈值80%，将自动扩充另一批见证者加入见证，比如第一批10个人，第二批20人，第三批40人，每批都重新选择新的候选人，重新计票
//若第二批还是无人参与则继续扩充，直到有人参与。
//用未来的收益作为质押，就不需要大额质押了。

// 公示期（1min 5min 15 min 30min 1h 2h 24h）
//上账tx有公示期状态不会马上，任何人可以发起挑战，只需质押100U的资金，挑战将由更多见证者或者更高级质押者裁决。

// 挑战阶段
//挑战成功将将被全部罚没witness的现有抵押，80%加入基金会，20%分给挑战者。
//挑战失败将罚没挑战者资金，100%加入基金会.
//动态指定witness，以满足witness的质押>>入账资金。并借此增大witness规模，增加系统安全性和参与度
//一半跨链手续费，一半token奖励（每个区块固定，按质押金额*witness次数分配）

// 问题1、pending的资产该作何处理？
// 答:签名状态有,通过、未通过。矿工可以选择拒绝签名，若签名了后期恶意的tx,可能被发起挑战而损失矿工自己资金。
// 问题2、如何解决冒领的问题？
// 转账发起方填写memo 指定收款地址。
